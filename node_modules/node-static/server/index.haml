%html
	%head
		%meta{charset: "utf-8"}
		%title Test
		%link{rel: "stylesheet", href: "Content/css/font-awesome.min.css"}
		%link{rel: "stylesheet", href: "Content/css/style.min.css"}
		%script{src: "Scripts/jquery-1.12.3.min.js"}
		%script{src: "Scripts/handlebars-v4.0.5.js"}
		%script{src: "Scripts/script.js", defer: ""}
	%body
		.bg-login
		.main-wrap.clearfix
			.login-wrap
				.author
				.login
					%input.field-text.js-login{type: "text", placeholder: "user-id"}
					.button.js-auth Ok
			.offer-plates
				.column
				.column
				.column
				.column
	.lightboxes
	%script#offer-templ{type: "text/x-handlebars-template"}
		%div{"data-offer-id": "{{id}}", class: "lightbox-wrap {{#if states.hiddenOfferLightbox}}hidden{{/if}}"}
			.lightbox.offer
				.lightbox-header
					.author
						%img.avatar{src: "{{author.0.avatar}}"}
						.content
							%a.person-name.link{href: "/"} {{author.0.fullname}}
							%br
							%span.status Нуждается в этом
						%div{class: "button js-remove-offer {{#ifCond author.0.userId '!=' user.id}}hidden{{/ifCond}}", "data-button": "removeOffer"} Удалить предложение
					.close-item.js-close{"data-button": "closeOfferLightbox"}
						%span.icon.fa.fa-times
						%span.content Закрыть
				.lightbox-body
					.main-content.clearfix
						.offer-content
							.title-wrap
								.offer-title {{title}}
								.offer-category {{category}}
							.offer-img-wrap
								%img.offer-img{src: "{{img}}"}
							.offer-description {{description}}
						.social-actions
							%div{class: "button js-save-lbx {{#each saved}}{{#ifCond userId '==' ../user.id}}active{{/ifCond}}{{/each}}", "data-button": "save-lbx"} Добавить к себе
							%div{class: "button js-like-lbx {{#each likes}}{{#ifCond userId '==' ../user.id}}active{{/ifCond}}{{/each}}", "data-button": "like-lbx"} Мне нравится
							%div{class: "button js-view-answer {{#if states.hiddenAnswers}}{{else}}active{{/if}}", "data-button": "viewAnswer"} Комменировать
					%div{class: "comments {{#if states.hiddenAnswers}}hidden{{/if}}"}
						.latest-comments
							{{#renderLatestMessages answers 3}}
							{{#each this}}
							.author{"data-message-id": "{{id}}"}
								%img.avatar{src: "{{avatar}}"}
								.content
									%span.comment {{comment}}
								{{#ifCond userId '==' ../../user.id}}
								.close-item.js-remove-answer
									%span.icon.fa.fa-times{"data-button": "removeAnswer"}
								{{/ifCond}}
							{{/each}}
							{{/renderLatestMessages}}
						.add-answer
							.author
								%img.avatar{src: "{{user.avatar}}"}
								.content
									%textarea.field-textarea.js-answer{placeholder: "Комментировать", maxlength: "500"}
				.lightbox-footer
					{{#if saved.length}}
					.saved-info
						%span.title {{saved.length}} добавили себе
						%ul.list
							{{#each saved}}
							%li.list-item
								%img.avatar{src: "{{avatar}}"}
							{{/each}}
					{{/if}}
					{{#if likes.length}}
					.liked-info
						%span.title {{likes.length}} нравится
						%ul.list
							{{#each likes}}
							%li.list-item
								%img.avatar{src: "{{avatar}}"}
							{{/each}}
					{{/if}}

%script#offer-card-templ{type: "text/x-handlebars-template"}
	.js-offer-wrap{"data-offer-id": "{{id}}"}
		.offer-plate
			.offer-img-wrap
				%img.offer-img{src: "{{img}}"}
			.view-offer.js-open-offer{"data-button": "openOfferLightbox"} Ознакомиться с предложением
			.social-actions
				%div{class: "item fa fa-lightbulb-o js-save {{#each saved}}{{#ifCond userId '==' ../user.id}}active{{/ifCond}}{{/each}}", "data-button": "save"}
				%div{class: "item fa fa-heart js-like {{#each likes}}{{#ifCond userId '==' ../user.id}}active{{/ifCond}}{{/each}}", "data-button": "like"}
				%div{class: "item fa fa-plus js-view-comment {{#if states.hiddenComments}}{{else}}active{{/if}}", "data-button": "viewComment"}
				.item.fa.fa-comment.js-open-offer{"data-button": "openOfferLightbox"}
			.offer-content
				.description
					.offer-title {{title}}
					.offer-category {{category}}
					.offer-date {{dateFrom}}-{{dateTo}}
					.offer-location {{location}}
				.social-info
					{{#if likes.length}}
					%span.item.count-likes {{likes.length}} нравится
					{{/if}}
					{{#if comments.length}}
					%span.item.count-comments {{comments.length}} комментария
					{{/if}}
					{{#if answers.length}}
					%span.item.count-answers {{answers.length}} отзыва
					{{/if}}
					{{#if saved.length}}
					%span.item.saved-info {{saved.length}} добавили себе
					{{/if}}
				.offer-author
					.author
						%img.avatar{src: "{{author.0.avatar}}"}
						.content
							%a.person-name.link{href: "/"} {{author.0.fullname}}
							%br
							%span.status предлагает
				%div{class: "comments {{#if states.hiddenComments}}hidden{{/if}}"}
					.latest-comments
						{{#renderLatestMessages comments 5}}
						{{#each this}}
						.author{"data-message-id": "{{id}}"}
							%img.avatar{src: "{{avatar}}"}
							.content
								{{#trancate comment 40}}
								%span.comment {{this}}
								{{/trancate}}
							{{#ifCond userId '==' ../../user.id}}
							.close-item.js-remove-comment
								%span.icon.fa.fa-times{"data-button": "removeComment"}
							{{/ifCond}}
						{{/each}}
						{{/renderLatestMessages}}
					.add-comment
						.author
							%img.avatar{src: "{{user.avatar}}"}
							.content
								%input.field-text.js-comment{type: "text", placeholder: "Комментировать"}

%script#user-plate-templ{type: "text/x-handlebars-template"}
	%img.avatar{src: "{{avatar}}"}
	.content
		%span Вы вошли как:
		%br
		%a.person-name.link{href: "/"} {{fullname}}