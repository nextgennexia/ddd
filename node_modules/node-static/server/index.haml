%html
	%head
		%meta{:charset => "utf-8"}
		%title Test
		%link{:rel => "stylesheet", :href => "Content/css/font-awesome.min.css"}
		%link{:rel => "stylesheet", :href => "Content/css/style.min.css"}
		%script{:src => "Scripts/jquery-1.12.3.min.js"}
		%script{:src => "Scripts/handlebars-v4.0.5.js"}
		%script{:src => "Scripts/script.js", :defer => ""}
	%body
		.bg-login
		.main-wrap.clearfix
			.login-wrap
				.author
				.login
					%input.field-text{:type => "text", :placeholder => "user-id"}
					.button Ok
			.offer-plates
				.column
				.column
				.column
				.column
	.lightbox-wrap.hidden
	%script#offer-templ{:type => "text/x-handlebars-template"}
		.lightbox.offer{:"data-id" => "{{id}}"}
			.lightbox-header
				.author
					%img.avatar{:src => "{{author.0.avatar}}"}
					.content
						%a.person-name.link{:href => "/"} {{author.0.fullname}}
						%br
						%span.status Нуждается в этом
					%div{:class => "button {{#ifCond author.0.userId '!=' user.id}}hidden{{/ifCond}}", :"data-button" => "removeOffer"} Удалить предложение
				.close-item{:"data-button" => "closeOfferLightbox"}
					%span.icon.fa.fa-times
					%span.content Закрыть
			.lightbox-body
				.main-content.clearfix
					.offer-content
						.title-wrap
							.offer-title {{title}}
							.offer-category {{category}}
						.offer-img-wrap
							%img.offer-img{:src => "{{img}}"}
						.offer-description {{description}}
					.social-actions
						%div{:class => "button {{#each saved.0.fromUsers}}{{#ifCond userId '==' user.id}}active{{/ifCond}}{{/each}}", :"data-button" => "save"} Добавить к себе
						%div{:class => "button {{#each likes.0.fromUsers}}{{#ifCond userId '==' user.id}}active{{/ifCond}}{{/each}}", :"data-button" => "like"} Мне нравится
						%div{:class => "button {{#if states.hiddenAnswers}}{{else}}active{{/if}}", :"data-button" => "viewAnswer"} Комменировать
				%div{:class => "comments {{#if states.hiddenAnswers}}hidden{{/if}}"}
					.latest-comments
						{{#renderLatestMessages answers.0.fromUsers 3 0}}
						.author{:"data-id" => "{{id}}"}
							%img.avatar{:src => "{{avatar}}"}
							.content
								%span.comment {{comment}}
							{{#ifCond userId '==' ../user.id}}
							.close-item
								%span.icon.fa.fa-times{:"data-button" => "removeAnswer"}
							{{/ifCond}}
						{{/renderLatestMessages}}
					.add-answer
						.author
							%img.avatar{:src => "{{user.avatar}}"}
							.content
								%textarea.field-textarea.js-answer{:placeholder => "Комментировать", :maxlength => "500",:"data-id" => "{{id}}"}
			.lightbox-footer
				{{#if saved.0.count}}
				.saved-info
					%span.title {{saved.0.count}} добавили себе
					%ul.list
						{{#each saved.0.fromUsers}}
						%li.list-item
							%img.avatar{:src => "{{avatar}}"}
						{{/each}}
				{{/if}}
				{{#if likes.0.count}}
				.liked-info
					%span.title {{likes.0.count}} нравится
					%ul.list
						{{#each likes.0.fromUsers}}
						%li.list-item
							%img.avatar{:src => "{{avatar}}"}
						{{/each}}
				{{/if}}

%script#offer-card-templ{:type => "text/x-handlebars-template"}
	.js-offer-card-wrap{:"data-id" => "{{id}}"}
		.offer-plate
			.offer-img-wrap
				%img.offer-img{:src => "{{img}}"}
			.view-offer{:"data-button" => "openOfferLightbox"} Ознакомиться с предложением
			.social-actions
				%div{:class => "item fa fa-lightbulb-o {{#each saved.0.fromUsers}}{{#ifCond userId '==' ../user.id}}active{{/ifCond}}{{/each}}", :"data-button" => "save"}
				%div{:class => "item fa fa-heart {{#each likes.0.fromUsers}}{{#ifCond userId '==' ../user.id}}active{{/ifCond}}{{/each}}", :"data-button" => "like"}
				%div{:class => "item fa fa-plus {{#if states.hiddenComments}}{{else}}active{{/if}}", :"data-button" => "viewComment"}
				.item.fa.fa-comment{:"data-button" => "openOfferLightbox"}
			.offer-content
				.description
					.offer-title {{title}}
					.offer-category {{category}}
					.offer-date {{dateFrom}}-{{dateTo}}
					.offer-location {{location}}
				.social-info
					{{#if likes.0.count}}
					%span.item.count-likes {{likes.0.count}} нравится
					{{/if}}
					{{#if comments.0.count}}
					%span.item.count-comments {{comments.0.count}} комментария
					{{/if}}
					{{#if answers.0.count}}
					%span.item.count-answers {{answers.0.count}} отзыва
					{{/if}}
					{{#if saved.0.count}}
					%span.item.saved-info {{saved.0.count}} добавили себе
					{{/if}}
				.offer-author
					.author
						%img.avatar{:src => "{{author.0.avatar}}"}
						.content
							%a.person-name.link{:href => "/"} {{author.0.fullname}}
							%br
							%span.status предлагает
				%div{:class => "comments {{#if states.hiddenComments}}hidden{{/if}}"}
					.latest-comments
						{{#renderLatestMessages comments.0.fromUsers 5 40}}
						.author{:"data-id" => "{{id}}"}
							%img.avatar{:src => "{{avatar}}"}
							.content
								%span.comment {{comment}}
							{{#ifCond userId '==' ../user.id}}
							.close-item
								%span.icon.fa.fa-times{:"data-button" => "removeComment"}
							{{/ifCond}}
						{{/renderLatestMessages}}
					.add-comment
						.author
							%img.avatar{:src => "{{user.avatar}}"}
							.content
								%input.field-text.js-comment{:type => "text", :placeholder => "Комментировать",:"data-id" => "{{id}}"}

%script#user-plate-templ{:type => "text/x-handlebars-template"}
	%img.avatar{:src => "{{avatar}}"}
	.content
		%span Вы вошли как:
		%br
		%a.person-name.link{:href => "/"} {{fullname}}