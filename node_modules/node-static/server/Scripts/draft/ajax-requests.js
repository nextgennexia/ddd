var
  offers = [],
  user = {
    fullname: 'Гость',
    avatar: '../../../images/users/anonymous.png'
  };

$('.login .button').on('click', function () {
  getLoggedUser($('.login .field-text').val());
})

getOffers();

function getOffers() {
  $.ajax({
    method: 'GET',
    url: '/offers.json',
    dataType: 'json',
    cache: false,
    success: function(data) {
      $.each(data,
        function() {
          offers = data.slice();
        });
      renderShortOffers();
    }
  });
}

function offerRefresh() {
  $.ajax({
    method: 'POST',
    url: '/refresh',
    data: JSON.stringify(offers),
    dataType: 'json',
    success: function(data) {
      try {
        offers = data.slice();
      } catch (e) {
        offerRefresh();
      }
    }
  });
}

function getLoggedUser(id) {
  $.ajax({
    method: 'POST',
    url: '/get-user',
    data: id,
    dataType: 'json',
    success: function (data) {
      user = data;
      renderTemplate('#user-plate-templ', '.login-wrap .author', user);
      renderShortOffers();
    }
  });
};