var
  offers = [],
  user = {
    fullname: 'Гость',
    avatar: '../../../images/users/anonymous.png'
  };

$('.login .button').on('click', function () {
    getLoggedUser($('.login .field-text').val());
})

getOffers();

function getOffers() {
  $.get('/offers.json', function (data) {
    $.each(data, function () {
      offers = data.slice();
    });
    renderShortOffers();
  }, 'json');
}

function offerRefresh() {
  $.post('/refresh', JSON.stringify(offers), function (data) {
    try {
      offers = data.slice();
    } catch (e) {
      offerRefresh();
    }
  }, 'json');
}

function getLoggedUser(id) {
  $.post('/get-user', id, function (data) {
    user = data;
    renderLoggedUser();
    renderShortOffers();
  }, 'json', 'text/plain');
};